---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import PurchaseLink from "../components/PurchaseLink.astro";
import LyricsExpander from "../components/LyricsExpander.tsx";

interface Props {
  album: CollectionEntry<"albums">["data"];
}

const { album } = Astro.props;

const formattedDate = new Intl.DateTimeFormat("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
  timeZone: "utc",
}).format(new Date(album.releaseDate));
---

<div class="flex flex-wrap gap-8">
  <div class="w-full space-y-4 md:w-64">
    <Image
      class="lazyload w-full rounded-sm shadow-2xl"
      src={album.artwork}
      alt={`Album artwork for ${album.title}`}
    />
    <ul class="hidden grid-cols-2 gap-4 text-sm md:grid">
      {
        album.links.map((link) => {
          return (
            <li>
              <PurchaseLink href={link.url} type={link.type} />
            </li>
          );
        })
      }
    </ul>
  </div>
  <div class="flex-1 space-y-8 rounded bg-black/40 p-4 md:space-y-6">
    <div class="space-y-2 md:space-y-0">
      <h3 class="font-brand text-4xl leading-none font-light tracking-wide">
        {album.title}
      </h3>
      <div class="text-sm font-normal text-gray-100">
        <p class="tracking-wider">{formattedDate}</p>
      </div>
      <ul
        class="grid grid-cols-2 flex-wrap justify-between gap-4 text-sm font-medium text-gray-300 md:hidden"
      >
        {
          album.links.map((link) => {
            return (
              <li>
                <PurchaseLink href={link.url} type={link.type} />
              </li>
            );
          })
        }
      </ul>
    </div>

    <div class="max-w-prose">{album.description}</div>
    <div>
      <h4 class="mb-2 text-2xl leading-relaxed font-normal">Tracks</h4>
      <ul class="text-sm">
        {
          album.tracks.map((track) => {
            const { lyrics } = track;
            return (
              <li class="mb-1">
                {lyrics ? (
                  <LyricsExpander
                    trackName={track.title}
                    lyrics={lyrics}
                    client:load
                  />
                ) : (
                  <span>{track.title}</span>
                )}
              </li>
            );
          })
        }
      </ul>
    </div>
  </div>
</div>
